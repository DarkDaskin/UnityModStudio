<platformUi:DialogWindow
  x:Class="UnityModStudio.RimWorld.ProjectWizard.ProjectWizardWindow"
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:commonOptions="clr-namespace:UnityModStudio.RimWorld.Common.Options;assembly=UnityModStudio.RimWorld.Common"
  xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
  xmlns:local="clr-namespace:UnityModStudio.RimWorld.ProjectWizard"
  xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
  xmlns:options="clr-namespace:UnityModStudio.Options;assembly=UnityModStudio.Options"
  xmlns:platformUi="clr-namespace:Microsoft.VisualStudio.PlatformUI;assembly=Microsoft.VisualStudio.Shell.15.0"
  Title="RimWorld mod configuration"
  Width="400"
  d:DataContext="{d:DesignInstance local:ProjectWizardViewModel}"
  Icon="UnityModStudio-RimWorld.ico"
  ShowInTaskbar="False"
  SizeToContent="Height"
  WindowStartupLocation="CenterOwner"
  mc:Ignorable="d">

  <Window.Resources>
    <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
    <options:EqualityConverter x:Key="EqualityConverter" />

    <Style BasedOn="{StaticResource {x:Type Button}}" TargetType="Button">
      <Setter Property="Margin" Value="4" />
    </Style>
    <Style BasedOn="{StaticResource {x:Type TextBox}}" TargetType="TextBox">
      <Setter Property="Margin" Value="4" />
    </Style>
    <Style BasedOn="{StaticResource {x:Type options:ContentControlWithValidation}}" TargetType="options:ContentControlWithValidation">
      <Setter Property="Margin" Value="4" />
    </Style>
  </Window.Resources>

  <Grid Margin="4">
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto" />
      <RowDefinition Height="Auto" />
      <RowDefinition Height="Auto" />
      <RowDefinition Height="Auto" />
      <RowDefinition Height="Auto" />
    </Grid.RowDefinitions>

    <GroupBox Header="Game versions">
      <Grid>
        <Grid.ColumnDefinitions>
          <ColumnDefinition />
          <ColumnDefinition Width="Auto" />
        </Grid.ColumnDefinitions>

        <ItemsControl Grid.Column="0" ItemsSource="{Binding GameVersions}">
          <ItemsControl.ItemTemplate>
            <DataTemplate DataType="{x:Type local:ProjectWizardViewModel+GameVersionViewModel}">
              <CheckBox
                Margin="2"
                Content="{Binding Version}"
                IsChecked="{Binding IsSelected}" />
            </DataTemplate>
          </ItemsControl.ItemTemplate>
        </ItemsControl>

        <TextBlock
          Grid.Column="0"
          Text="No game installations found."
          Visibility="{Binding AreGameVersionsAbsent, Converter={StaticResource BooleanToVisibilityConverter}}" />

        <Button
          Grid.Column="1"
          Width="70"
          Height="20"
          VerticalAlignment="Top"
          Command="{Binding OpenGameRegistryCommand}"
          Content="Configure..." />
      </Grid>
    </GroupBox>

    <GroupBox Grid.Row="1" Header="3rd-party dependencies">
      <StackPanel>
        <CheckBox Content="Use Harmony library" IsChecked="{Binding UseHarmony}" />
      </StackPanel>
    </GroupBox>

    <GroupBox Grid.Row="2" Header="Mod metadata">
      <Grid>
        <Grid.RowDefinitions>
          <RowDefinition Height="Auto" />
          <RowDefinition Height="Auto" />
          <RowDefinition Height="Auto" />
          <RowDefinition Height="Auto" />
          <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="Auto" />
          <ColumnDefinition />
        </Grid.ColumnDefinitions>

        <Label
          Grid.Row="0"
          Grid.Column="0"
          Content="Package ID:"
          Target="{Binding ElementName=ModPackageIdText}" />
        <options:ContentControlWithValidation Grid.Row="0" Grid.Column="1">
          <TextBox Name="ModPackageIdText" Text="{Binding ModPackageId, UpdateSourceTrigger=PropertyChanged, NotifyOnValidationError=True}" />
        </options:ContentControlWithValidation>


        <Label
          Grid.Row="1"
          Grid.Column="0"
          Content="Author:"
          Target="{Binding ElementName=ModAuthorText}" />
        <options:ContentControlWithValidation Grid.Row="1" Grid.Column="1">
          <TextBox Name="ModAuthorText" Text="{Binding ModAuthor, UpdateSourceTrigger=PropertyChanged, NotifyOnValidationError=True}" />
        </options:ContentControlWithValidation>

        <Label
          Grid.Row="2"
          Grid.Column="0"
          Content="Name:"
          Target="{Binding ElementName=ModNameText}" />
        <options:ContentControlWithValidation Grid.Row="2" Grid.Column="1">
          <TextBox Name="ModNameText" Text="{Binding ModName, UpdateSourceTrigger=PropertyChanged, NotifyOnValidationError=True}" />
        </options:ContentControlWithValidation>

        <Label
          Grid.Row="3"
          Grid.Column="0"
          Content="Description:"
          Target="{Binding ElementName=ModDescriptionText}" />
        <options:ContentControlWithValidation
          Grid.Row="4"
          Grid.Column="0"
          Grid.ColumnSpan="2"
          Margin="4,0,4,4">
          <TextBox
            Name="ModDescriptionText"
            Height="54"
            AcceptsReturn="True"
            Text="{Binding ModDescription, UpdateSourceTrigger=PropertyChanged, NotifyOnValidationError=True}" />
        </options:ContentControlWithValidation>
      </Grid>
    </GroupBox>

    <GroupBox Grid.Row="3" Header="Project layout">
      <StackPanel>
        <RadioButton
          Content="Assets at top level"
          IsChecked="{Binding ProjectLayout, Converter={StaticResource EqualityConverter}, ConverterParameter={x:Static commonOptions:ProjectLayout.AssetsAtTopLevel}}"
          ToolTip="Mod assets at solution directory, project files at Sources sub-directory." />
        <RadioButton
          Content="Project at top level"
          IsChecked="{Binding ProjectLayout, Converter={StaticResource EqualityConverter}, ConverterParameter={x:Static commonOptions:ProjectLayout.ProjectAtTopLevel}}"
          ToolTip="Project files at solution directory, mod assets at Assets sub-directory." />
      </StackPanel>
    </GroupBox>

    <StackPanel
      Grid.Row="4"
      Grid.Column="0"
      HorizontalAlignment="Right"
      Orientation="Horizontal">

      <StackPanel.Resources>
        <Style BasedOn="{StaticResource {x:Type Button}}" TargetType="Button">
          <Setter Property="Width" Value="80" />
        </Style>
      </StackPanel.Resources>

      <Button
        Command="{Binding ConfirmCommand}"
        Content="OK"
        IsDefault="True" />
      <Button
        Command="{Binding CancelCommand}"
        Content="Cancel"
        IsCancel="True" />
    </StackPanel>
  </Grid>
</platformUi:DialogWindow>
